<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Python - Pi4U</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Python";
    var mkdocs_page_input_path = "python.md";
    var mkdocs_page_url = "/python/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> Pi4U</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="..">Home</a>
	    </li>
          
            <li class="toctree-l1 current">
		
    <a class="current" href="./">Python</a>
    <ul class="subnav">
            
    <li class="toctree-l2"><a href="#python-interface-of-tmcmc">Python interface of TMCMC</a></li>
    
        <ul>
        
            <li><a class="toctree-l3" href="#tmcmc">TMCMC</a></li>
        
            <li><a class="toctree-l3" href="#fitness-function">Fitness function</a></li>
        
            <li><a class="toctree-l3" href="#plotting">Plotting</a></li>
        
            <li><a class="toctree-l3" href="#example">Example</a></li>
        
            <li><a class="toctree-l3" href="#installation-and-testing">Installation and testing</a></li>
        
        </ul>
    

    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../matlab/">Matlab</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../rlib/">R</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../hpc/">C/C++</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../about/">About</a>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">Pi4U</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>Python</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="python-interface-of-tmcmc">Python interface of TMCMC</h1>
<p>Module tmcmc implements the TMCMC (Transitional Markov-Chain Monte Carlo) algorithm.</p>
<p>We use the C implementation of the algorithm and the ctypes wrapper module for calling it from Python.
Since the function we are sampling from is also written in Python, we use embedded Python to call the
function from the C code and <em>numpy</em> to pass arguments between the two environments.</p>
<h2 id="tmcmc">TMCMC</h2>
<p>The Python interface of TMCMC is defined as follows:</p>
<p><strong>def tmcmc(fitfun, dim=2, maxstages=20, popsize=1024, lowerbound=[-6,-6], upperbound=[6,6], id=0):</strong></p>
<p>Inputs:</p>
<ul>
<li><strong>fitfun</strong>: python script name (without the .py extension) that implements the log-likelihood function.
The prototype is: fitfun(x, dim), where <em>x</em> is a vector of parameter values and <em>dim</em> the number of parameters.</li>
<li><strong>dim</strong>: number of parameters</li>
<li><strong>maxstages</strong>: maximum number of stages that can be performed by the TMCMC algorithm</li>
<li><strong>popsize</strong>: number of samples per stage</li>
<li><strong>lowerbound</strong>: lower bound for each parameter</li>
<li><strong>upperbound</strong>: uppoer bound for each parameter</li>
<li><strong>id</strong>: integer identifier for the specific tmcmc() call. The value is appended to the output files generated by the algorithm.</li>
</ul>
<p>Outputs:</p>
<p>The tmcmc function returns the log-evidence of the model.
In addition, for each stage of the algorithm, the evaluation points and their log-likelihood are stored in text files
named as curgen_db_xxx_yyy.txt, where xxx: id of the tmcmc() call, and yyy: stage of the algorithm.</p>
<h2 id="fitness-function">Fitness function</h2>
<p>The fitness function typically computes the model output and returns the log-likelihood of the data</p>
<p><strong>def fitfun(x, dim):</strong></p>
<ul>
<li><strong>x</strong>: the parameters (theta) of the model</li>
<li><strong>dim</strong>: the number of parameters</li>
</ul>
<h2 id="plotting">Plotting</h2>
<p>2D scatter plots of the samples stored in the output text files, colored according to the log-likelihood values,
can be produced using the  of the plot_gen() function.</p>
<p><strong>def plot_gen(filename, dim=2, i=1, j=2, show=1, save=0):</strong></p>
<ul>
<li><strong>filename</strong>: curgen_db_xxx_yyy.txt file</li>
<li><strong>dim</strong>: number of parameters</li>
<li><strong>i</strong>: first parameter</li>
<li><strong>j</strong>: second parameter</li>
<li><strong>show</strong>: depict the plot on the screen</li>
<li><strong>save</strong>: save the plot in a png file (filename.png)</li>
</ul>
<h2 id="example">Example</h2>
<h3 id="demopy">demo.py</h3>
<pre><code># Import whatever is necessary
import sys
sys.path.append("../lib_python")
from tmcmc import *

logEv=tmcmc("fitfun2",dim=2,maxstages=20,popsize=4096,lowerbound=[-10,-10],upperbound=[10,10],id=2)
print("logEv=",logEv[0])

from plot_gen import *
plot_gen('curgen_db_002_003.txt', dim=2, i=1, j=2, show=1, save=1)
</code></pre>
<h3 id="fitfun2py">fitfun2.py</h3>
<pre><code># two multivariate gaussians
from scipy.stats import multivariate_normal as mvnorm
import math

def fitfun2(x, dim):

    mean1 = [-5, -5]
    cov1 = [[1, 0], [0, 1]]  # diagonal covariance

    mean2 = [5, 5]
    cov2 = [[1, 0], [0, 1]]  # diagonal covariance

    s = mvnorm.pdf(x, mean1, cov1) + mvnorm.pdf(x, mean2, cov2)
    s = math.log(s)

    return s
</code></pre>
<h2 id="installation-and-testing">Installation and testing</h2>
<h3 id="prerequisites">Prerequisites</h3>
<ul>
<li>C compiler</li>
<li>Python</li>
<li>Numpy</li>
<li>GNU GSL library</li>
</ul>
<h3 id="steps">Steps</h3>
<ol>
<li>
<p>Download from github:</p>
<pre><code>git clone https://github.com/cselab/pi4u.git -b tmcmc
</code></pre>
</li>
<li>
<p>Go to pi4u/src and build the library:</p>
<pre><code>cd pi4u/src; make
</code></pre>
</li>
<li>
<p>Go to demo_python and run demo.py</p>
<pre><code>cd demo; python2.7 demo.py
</code></pre>
</li>
</ol>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../matlab/" class="btn btn-neutral float-right" title="Matlab">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href=".." class="btn btn-neutral" title="Home"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>
    
  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href=".." style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../matlab/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script src="../js/theme.js"></script>

</body>
</html>
